<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Caixa - Plano A</title>
    <link rel="stylesheet" href="/static/index/style/index.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006231685074486"
     crossorigin="anonymous"></script>
</head>
<body>
    <div id="lateralMenu">
        <div class="menu-part">
            <section class="menu-container1">
                <img draggable="false" src="/static/images/LOGO.png" alt="">
            </section>
            <div class="a-list-menu">
                <a href=""><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                    <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="icon-a" d="M8.45999 6.29999C8.26108 6.29999 8.07031 6.37901 7.92966 6.51966C7.78901 6.66031 7.70999 6.85108 7.70999 7.04999C7.70999 7.2489 7.78901 7.43967 7.92966 7.58032C8.07031 7.72097 8.26108 7.79999 8.45999 7.79999H15.14L6.51999 16.42C6.4463 16.4886 6.3872 16.5715 6.34621 16.6634C6.30522 16.7554 6.28317 16.8548 6.2814 16.9555C6.27962 17.0562 6.29815 17.1562 6.33587 17.2496C6.37359 17.343 6.42973 17.4278 6.50095 17.499C6.57217 17.5702 6.657 17.6264 6.75039 17.6641C6.84378 17.7018 6.94381 17.7204 7.04451 17.7186C7.14521 17.7168 7.24453 17.6948 7.33653 17.6538C7.42853 17.6128 7.51133 17.5537 7.57999 17.48L16.2 8.85999V15.54C16.2 15.7389 16.279 15.9297 16.4197 16.0703C16.5603 16.211 16.7511 16.29 16.95 16.29C17.1489 16.29 17.3397 16.211 17.4803 16.0703C17.621 15.9297 17.7 15.7389 17.7 15.54V7.04999C17.6995 6.95029 17.6791 6.85171 17.64 6.75999C17.5856 6.63213 17.4971 6.52164 17.3843 6.44054C17.2714 6.35944 17.1385 6.31083 17 6.29999H8.45999Z" fill="#000000"/>
                    </svg>Como Jogar</a>
                <a href=""><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                    <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="icon-a" d="M8.45999 6.29999C8.26108 6.29999 8.07031 6.37901 7.92966 6.51966C7.78901 6.66031 7.70999 6.85108 7.70999 7.04999C7.70999 7.2489 7.78901 7.43967 7.92966 7.58032C8.07031 7.72097 8.26108 7.79999 8.45999 7.79999H15.14L6.51999 16.42C6.4463 16.4886 6.3872 16.5715 6.34621 16.6634C6.30522 16.7554 6.28317 16.8548 6.2814 16.9555C6.27962 17.0562 6.29815 17.1562 6.33587 17.2496C6.37359 17.343 6.42973 17.4278 6.50095 17.499C6.57217 17.5702 6.657 17.6264 6.75039 17.6641C6.84378 17.7018 6.94381 17.7204 7.04451 17.7186C7.14521 17.7168 7.24453 17.6948 7.33653 17.6538C7.42853 17.6128 7.51133 17.5537 7.57999 17.48L16.2 8.85999V15.54C16.2 15.7389 16.279 15.9297 16.4197 16.0703C16.5603 16.211 16.7511 16.29 16.95 16.29C17.1489 16.29 17.3397 16.211 17.4803 16.0703C17.621 15.9297 17.7 15.7389 17.7 15.54V7.04999C17.6995 6.95029 17.6791 6.85171 17.64 6.75999C17.5856 6.63213 17.4971 6.52164 17.3843 6.44054C17.2714 6.35944 17.1385 6.31083 17 6.29999H8.45999Z" fill="#000000"/>
                    </svg>Trailer</a>
            </div>
            <div class="categories-element">
                <label>Categorias:</label>
            </div>
            <section class="menu-description">
                <div class="categories-container">
                    <div class="categories-element">
                        <span>4-6 Jogadores</span>
                    </div>
                    <div class="categories-element">
                        <span>Diversão</span>
                    </div>
                    <div class="categories-element">
                        <span>Curto</span>
                    </div>
                    <div class="categories-element">
                        <span>Desenho</span>
                    </div>
                </div>
            </section>
            <div class="categories-element">
                <label>Descrição:</label>
            </div>
            <section class="menu-description">
                <p>Plágio Consentido é sobre provar quem é o melhor plagiador em uma batalha épica contra seus amigos.</p>
            </section>
        </div>
        <div class="menu-part">
            <section class="button-container">
                <button onclick="joinRoom()" class="game-btn">Entrar em Sala</button>
                <button onclick="createRoom()" class="game-btn">Criar Sala</button>
            </section>
        </div>
    </div>
    </div>
    <img draggable="false" id="logo" src="/static/images/index/planoA.png" alt="">
    <section id="inside">
        <div id="cardboardContainer">
            <div id="cardboardOpen">
                <div id="PCGame"></div>
            </div>
        </div>
        <footer id="footer">
            <div class="footer-element">
                <span id="queueMessage"></span>
            </div>
            <div class="footer-element">
                <a href="https://discord.gg/NNJTJ2b3k5"><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                    <svg width="800px" height="800px" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg">
                    <path class="icon-a" d="M18.59 5.88997C17.36 5.31997 16.05 4.89997 14.67 4.65997C14.5 4.95997 14.3 5.36997 14.17 5.69997C12.71 5.47997 11.26 5.47997 9.83001 5.69997C9.69001 5.36997 9.49001 4.95997 9.32001 4.65997C7.94001 4.89997 6.63001 5.31997 5.40001 5.88997C2.92001 9.62997 2.25001 13.28 2.58001 16.87C4.23001 18.1 5.82001 18.84 7.39001 19.33C7.78001 18.8 8.12001 18.23 8.42001 17.64C7.85001 17.43 7.31001 17.16 6.80001 16.85C6.94001 16.75 7.07001 16.64 7.20001 16.54C10.33 18 13.72 18 16.81 16.54C16.94 16.65 17.07 16.75 17.21 16.85C16.7 17.16 16.15 17.42 15.59 17.64C15.89 18.23 16.23 18.8 16.62 19.33C18.19 18.84 19.79 18.1 21.43 16.87C21.82 12.7 20.76 9.08997 18.61 5.88997H18.59ZM8.84001 14.67C7.90001 14.67 7.13001 13.8 7.13001 12.73C7.13001 11.66 7.88001 10.79 8.84001 10.79C9.80001 10.79 10.56 11.66 10.55 12.73C10.55 13.79 9.80001 14.67 8.84001 14.67ZM15.15 14.67C14.21 14.67 13.44 13.8 13.44 12.73C13.44 11.66 14.19 10.79 15.15 10.79C16.11 10.79 16.87 11.66 16.86 12.73C16.86 13.79 16.11 14.67 15.15 14.67Z" fill="#000000"/>
                    </svg>Comunidade</a>
                <a href=""><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                    <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="icon-a" d="M8.45999 6.29999C8.26108 6.29999 8.07031 6.37901 7.92966 6.51966C7.78901 6.66031 7.70999 6.85108 7.70999 7.04999C7.70999 7.2489 7.78901 7.43967 7.92966 7.58032C8.07031 7.72097 8.26108 7.79999 8.45999 7.79999H15.14L6.51999 16.42C6.4463 16.4886 6.3872 16.5715 6.34621 16.6634C6.30522 16.7554 6.28317 16.8548 6.2814 16.9555C6.27962 17.0562 6.29815 17.1562 6.33587 17.2496C6.37359 17.343 6.42973 17.4278 6.50095 17.499C6.57217 17.5702 6.657 17.6264 6.75039 17.6641C6.84378 17.7018 6.94381 17.7204 7.04451 17.7186C7.14521 17.7168 7.24453 17.6948 7.33653 17.6538C7.42853 17.6128 7.51133 17.5537 7.57999 17.48L16.2 8.85999V15.54C16.2 15.7389 16.279 15.9297 16.4197 16.0703C16.5603 16.211 16.7511 16.29 16.95 16.29C17.1489 16.29 17.3397 16.211 17.4803 16.0703C17.621 15.9297 17.7 15.7389 17.7 15.54V7.04999C17.6995 6.95029 17.6791 6.85171 17.64 6.75999C17.5856 6.63213 17.4971 6.52164 17.3843 6.44054C17.2714 6.35944 17.1385 6.31083 17 6.29999H8.45999Z" fill="#000000"/>
                    </svg>Apoie</a>
        </footer>
    </section>

    <img id="fullscreen" src="fullscreen.svg" alt="">
    <div class="menu-inicial">
        <img draggable="false" id="cardboard" class="cardboard" src="/static/images/index/box.png" alt="">
        <div id="btnElement">
            <button onclick="abrirCaixa()" class="primary-btn">Abrir Caixa</button>
        </div>
    </div>
    <div id="errorContainer">
        <span id="errorMsg"></span>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        var socket = io({
            transports: ['websocket', 'polling']
        });

        let isCreatingRoom = false; // Rastreia se uma sala está sendo criada
        let socketId = null;

        socket.on('connect', function() {
            socketId = socket.id;
        });

        function joinRoom() {
            window.location.href = '/join'
        }

        function createRoom() {
            if (isCreatingRoom) return; // Evita múltiplos cliques
            isCreatingRoom = true; // Marca que o processo de criação está em andamento

            fetch('/create_room', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    'socket_id': socketId  // Passa o socket.id em vez de client_id
                })
            })
            .then(response => response.json())
            .then(data => {
                const errorMsg = document.getElementById('queueMessage');
                const errorContainer = document.getElementById('footer');
                const lateralMenu = document.getElementById('lateralMenu');

                if (data.message === 'All rooms are full, you have been added to the queue') {
                    const queuePosition = data.queue_position;
                    errorMsg.innerText = `Todas as salas estão cheias. Você está na fila, posição: ${queuePosition}. Se você recarregar a página, perderá sua posição na fila.`;
                    errorContainer.classList.add('waiting-room');
                    lateralMenu.classList.add('waiting-room');
                    listenForQueueUpdates(socketId); // Conecta ao socket para ouvir atualizações
                } 
                else if (data.room_id !== undefined) {
                    const roomId = data.room_id;
                    socket.disconnect()
                    window.location.href = `/host/${roomId}`;
                } 
                else {
                    console.error('Erro: Não foi possível criar a sala ou adicionar à fila');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            })
            .finally(() => {
                isCreatingRoom = false; // Restaura o estado após a tentativa de criação
            });
        }

        function listenForQueueUpdates(socketId) {
            socket.on('room_created', function(data) {
                if (data.socket_id === socketId) {
                    const roomId = data.room_id;
                    window.location.href = `/host/${roomId}`; // Redireciona para a sala
                } else {
                    createRoom()
                }
            });
            socket.on('queue_update', function(data) {
                createRoom()
            })
        }

        const fullscreenBtn = document.getElementById('fullscreen');

        fullscreenBtn.addEventListener('click', function() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) { // Firefox
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari, Opera
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
                document.documentElement.msRequestFullscreen();
            }
        });

/*        document.getElementById('options').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex].value;
            if (selectedOption === 'como_jogar') {
                document.getElementById('videoThumbnail').style.backgroundImage = 'url(/static/images/thumbnail1.png)'
            } else if (selectedOption === 'trailer') {
                console.log('Trailer');
            }
        });

        document.querySelector('.menu-video-player').addEventListener('mouseover', function() {
        //    document.querySelector('.menu-part1 button').style.display = 'block';
        });
        document.querySelector('.menu-video-player').addEventListener('mouseout', function() {
            document.querySelector('.menu-part1 button').style.display = 'none';
        });*/


        function abrirCaixa(){
            const cardboard = document.getElementById('cardboard')
            const cardboardContainer = document.getElementById('cardboardContainer')
            const btn = document.getElementById('btnElement')

            cardboard.classList.add('caindo')
            btn.classList.add('desappear')
            setTimeout(() => {
            cardboardContainer.classList.add('aparecendo')
            }, 2000);
        }

        function showGame(){
            const PCGame = document.getElementById('PCGame')
            const cardboardContainer = document.getElementById('cardboardContainer')
            const menu = document.getElementById('lateralMenu')
            const inactive = document.createElement('div')
            const body = document.body

            PCGame.addEventListener("click", function(){
                PCGame.classList.add('ativo')
                menu.classList.add('active')
                cardboardContainer.classList.add('menu-active')

                inactive.classList.add('inativo')
                body.appendChild(inactive)
            })

            inactive.addEventListener("click", function(){
                PCGame.classList.remove('ativo')
                menu.classList.remove('active')
                cardboardContainer.classList.remove('menu-active')

                body.removeChild(inactive)
            })
        }

        showGame()

    </script>
</body>
</html>